// ============================================================================
// BEAT-SPECIFIC TERMINAL CONTENT
// Educational terminal output that mirrors sidebar "How It Works" content
// ============================================================================

/**
 * Maps story beat IDs to custom terminal output arrays.
 * Each beat gets content that directly demonstrates what's being taught.
 */
export const BEAT_TERMINAL_CONTENT: Record<string, string[]> = {
  // ==========================================================================
  // CHAPTER 1: THE ARCANE LOOP (Agent Architecture)
  // ==========================================================================

  'what-is-agentic': [
    '$ claude "add input validation to login form"',
    '',
    '> Starting agentic loop...',
    '> Analyzing codebase structure...',
    '',
    '╭─ Loop 1 ─────────────────────────────────────╮',
    '│ Read: src/components/LoginForm.tsx          │',
    '│ Status: Understanding current implementation │',
    '╰──────────────────────────────────────────────╯',
    '',
    '╭─ Loop 2 ─────────────────────────────────────╮',
    '│ Edit: src/components/LoginForm.tsx          │',
    '│ Status: Adding email regex validation       │',
    '╰──────────────────────────────────────────────╯',
    '',
    '╭─ Loop 3 ─────────────────────────────────────╮',
    '│ Bash: npm test -- LoginForm                 │',
    '│ Status: Verifying changes work              │',
    '╰──────────────────────────────────────────────╯',
    '',
    '╭─ Loop 4 ─────────────────────────────────────╮',
    '│ Edit: src/components/LoginForm.tsx          │',
    '│ Status: Fixing test failure                 │',
    '╰──────────────────────────────────────────────╯',
    '',
    '> Loop complete. Task finished in 4 iterations.',
  ],

  'the-loop': [
    '> The Agentic Loop - Each Iteration',
    '',
    '┌─────────────────────────────────────────────┐',
    '│ Step 1: Build message array                 │',
    '│   system_prompt + conversation + new_prompt │',
    '├─────────────────────────────────────────────┤',
    '│ Step 2: API call to Claude                  │',
    '│   response = claude(messages, tools)        │',
    '├─────────────────────────────────────────────┤',
    '│ Step 3: Check stop reason                   │',
    '│   if stop_reason == "end_turn":             │',
    '│     → Return response to user               │',
    '├─────────────────────────────────────────────┤',
    '│ Step 4: Execute tool calls                  │',
    '│   for tool in response.tool_calls:          │',
    '│     result = execute(tool)                  │',
    '├─────────────────────────────────────────────┤',
    '│ Step 5: Append results, loop back           │',
    '│   messages.append(tool_results)             │',
    '│   → Go to Step 1                            │',
    '└─────────────────────────────────────────────┘',
  ],

  'model-is-80': [
    '$ claude "refactor auth system"',
    '',
    '> Model reasoning (internal):',
    '  "I need to understand the current auth flow,',
    '   identify pain points, and propose changes.',
    '   Let me start by reading the auth files..."',
    '',
    '> Tool calls decided by model:',
    '  1. Grep: "authentication" in src/',
    '  2. Read: src/auth/index.ts',
    '  3. Read: src/middleware/auth.ts',
    '',
    '> Model decision: "The auth middleware has',
    '  duplicate validation logic. I\'ll consolidate."',
    '',
    '> Edit: src/auth/index.ts',
    '> Edit: src/middleware/auth.ts',
    '',
    '───────────────────────────────────────────────',
    'The MODEL decides the approach.',
    'Your job: Good prompts + good CLAUDE.md',
  ],

  'model-selection': [
    '> Model Selection Guide',
    '',
    '┌─ Sonnet (Default) ───────────────────────────┐',
    '│ Speed: ████████████ Fast                     │',
    '│ Cost:  ██░░░░░░░░░░ ~$3/1M tokens            │',
    '│ Best for:                                    │',
    '│   • Clear, well-defined tasks               │',
    '│   • Boilerplate and refactoring             │',
    '│   • Implementation after planning           │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Opus ───────────────────────────────────────┐',
    '│ Speed: ████░░░░░░░░ Deliberate               │',
    '│ Cost:  ████████████ ~$15/1M tokens           │',
    '│ Best for:                                    │',
    '│   • Complex architecture decisions          │',
    '│   • Subtle bugs requiring deep reasoning    │',
    '│   • Novel problems without clear path       │',
    '└──────────────────────────────────────────────┘',
    '',
    '$ /model opus      # Switch to Opus',
    '$ /model sonnet    # Switch back to Sonnet',
    '$ Shift+Tab+Tab    # Plan mode (uses Opus)',
  ],

  // ==========================================================================
  // CHAPTER 2: THE ARCANE RESERVOIR (Context)
  // ==========================================================================

  'what-claude-sees': [
    '> What Claude Receives Per API Call',
    '',
    '┌─ System Prompt ──────────────────────────────┐',
    '│ CLAUDE.md content           ~2,500 tokens   │',
    '│ Tool definitions (8 tools)  ~1,200 tokens   │',
    '│ Active skills               ~500 tokens     │',
    '│ Base instructions           ~800 tokens     │',
    '├──────────────────────────────────────────────┤',
    '│ Subtotal:                   ~5,000 tokens   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Conversation History ───────────────────────┐',
    '│ User messages                               │',
    '│ Assistant responses                         │',
    '│ Tool call requests                          │',
    '│ Tool results (file contents, etc.)          │',
    '├──────────────────────────────────────────────┤',
    '│ Current conversation:       ~28,000 tokens  │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Your New Message ───────────────────────────┐',
    '│ "fix the bug in checkout"   ~8 tokens       │',
    '└──────────────────────────────────────────────┘',
    '',
    'Total this turn: ~33,008 tokens',
    'Context window: 200,000 tokens available',
  ],

  'context-degrades': [
    '> Context Window Quality Zones',
    '',
    '  0%                                      100%',
    '  │░░░░░░░░░░│░░░░░░░░░░│▓▓▓▓▓▓▓▓▓│████████│',
    '       ↓           ↓          ↓         ↓',
    '    Optimal    Good      Warning    Danger',
    '',
    '┌─ 0-20% (~40K tokens) ────────────────────────┐',
    '│ ● Full attention on all context             │',
    '│ ● Best quality responses                    │',
    '│ ● Recommended operating range               │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 20-35% ─────────────────────────────────────┐',
    '│ ● Slight degradation begins                 │',
    '│ ● Earlier messages may lose priority        │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 35-50% ─────────────────────────────────────┐',
    '│ ▲ WARNING: Significant degradation          │',
    '│ ● May miss details from earlier context     │',
    '│ ● Consider using /compact                   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 50%+ ───────────────────────────────────────┐',
    '│ ✗ DANGER: High risk of errors               │',
    '│ ● Use /clear for fresh start                │',
    '└──────────────────────────────────────────────┘',
  ],

  'claudemd-memory': [
    '$ cat CLAUDE.md',
    '',
    '# Project: E-Commerce Platform',
    '',
    '## Build Commands',
    '- Build: npm run build',
    '- Test: npm test',
    '- Lint: npm run lint',
    '- Deploy: npm run deploy:staging',
    '',
    '## Architecture',
    '/src',
    '  /components  - React components',
    '  /hooks       - Custom hooks',
    '  /services    - API services',
    '  /utils       - Helper functions',
    '/server',
    '  /routes      - Express routes',
    '  /middleware  - Auth, logging',
    '  /models      - Prisma models',
    '',
    '## Conventions',
    '- Use TypeScript strict mode',
    '- Prefer composition over inheritance',
    '- All components must have tests',
    '- Use React Query for server state',
    '',
    '## Known Issues',
    '- Payment webhook timeout: Use 30s limit',
    '- Safari SVG bug: Use PNG fallback',
    '',
    '───────────────────────────────────────────────',
    'Settings hierarchy:',
    '  ~/.claude/CLAUDE.md      (user-level)',
    '  ./CLAUDE.md              (project root)',
    '  ./subdir/CLAUDE.md       (scoped)',
  ],

  'clear-and-compact': [
    '> Context Management Commands',
    '',
    '┌─ /clear ─────────────────────────────────────┐',
    '│ Wipes conversation history completely       │',
    '│ KEEPS: CLAUDE.md loaded                     │',
    '│ Cost: Free                                  │',
    '│                                             │',
    '│ $ /clear                                    │',
    '│ > Conversation cleared.                     │',
    '│ > CLAUDE.md still loaded.                   │',
    '│ > Ready for new task.                       │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ /compact ───────────────────────────────────┐',
    '│ AI-summarizes conversation history          │',
    '│ PRESERVES: Key decisions & file changes     │',
    '│ Cost: ~2,000 tokens for summarization       │',
    '│                                             │',
    '│ $ /compact                                  │',
    '│ > Analyzing 156,231 tokens of history...    │',
    '│ > Creating intelligent summary...           │',
    '│                                             │',
    '│ Before:  156,231 tokens                     │',
    '│ After:    23,450 tokens                     │',
    '│ Saved:   132,781 tokens (85%)               │',
    '│                                             │',
    '│ Summary preserved:                          │',
    '│ - Auth system refactoring decisions         │',
    '│ - Files modified (12)                       │',
    '│ - Error resolutions (3)                     │',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 3: ENCHANTED ARTIFACTS (Tools)
  // ==========================================================================

  'tools-overview': [
    '> The 8 Core Tools',
    '',
    '┌──────────┬────────────────────────────────────┐',
    '│ READ     │ Load file contents into context    │',
    '│          │ Supports: code, images, PDFs       │',
    '├──────────┼────────────────────────────────────┤',
    '│ EDIT     │ Surgical text replacement          │',
    '│          │ old_string → new_string            │',
    '├──────────┼────────────────────────────────────┤',
    '│ WRITE    │ Create new files or overwrite      │',
    '│          │ Use for new files only             │',
    '├──────────┼────────────────────────────────────┤',
    '│ BASH     │ Execute shell commands             │',
    '│          │ git, npm, docker, etc.             │',
    '├──────────┼────────────────────────────────────┤',
    '│ GREP     │ Search file contents (ripgrep)     │',
    '│          │ Regex, file types, context         │',
    '├──────────┼────────────────────────────────────┤',
    '│ GLOB     │ Find files by pattern              │',
    '│          │ **/*.tsx, src/**/test.*            │',
    '├──────────┼────────────────────────────────────┤',
    '│ TASK     │ Spawn subagents                    │',
    '│          │ Fresh context, returns summary     │',
    '├──────────┼────────────────────────────────────┤',
    '│ TODO     │ Track task progress                │',
    '│          │ Visible to user in UI              │',
    '└──────────┴────────────────────────────────────┘',
    '',
    'Each tool call adds to context.',
    'Claude decides which tools based on your prompt.',
  ],

  'read-tool': [
    '> Using Read tool...',
    '',
    '┌─ Source Code ────────────────────────────────┐',
    '│ $ Read: src/auth/login.ts                   │',
    '│                                             │',
    '│   1│ import { useState } from \'react\'       │',
    '│   2│ import { validateEmail } from \'./util\' │',
    '│   3│                                        │',
    '│   4│ export function LoginForm() {          │',
    '│   5│   const [email, setEmail] = useState(\'\')│',
    '│  ...                                        │',
    '│  47│ }                                      │',
    '│                                             │',
    '│ Added 47 lines to context                   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Image File ─────────────────────────────────┐',
    '│ $ Read: docs/architecture.png               │',
    '│                                             │',
    '│ [Image analyzed visually by Claude]         │',
    '│ Detected: System architecture diagram       │',
    '│ Components: Auth service, API gateway...    │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ PDF Document ───────────────────────────────┐',
    '│ $ Read: docs/api-spec.pdf                   │',
    '│                                             │',
    '│ Extracted 12 pages of text + tables         │',
    '│ API endpoints documented: 47                │',
    '└──────────────────────────────────────────────┘',
    '',
    'Tip: Use offset/limit for large files',
    '$ Read: large.ts (offset: 100, limit: 50)',
  ],

  'edit-write-tools': [
    '> Edit vs Write Tools',
    '',
    '┌─ EDIT: Surgical Replacement ─────────────────┐',
    '│ Must read file first!                       │',
    '│                                             │',
    '│ $ Edit: src/config.ts                       │',
    '│   old: "const timeout = 30"                 │',
    '│   new: "const timeout = 60"                 │',
    '│                                             │',
    '│ ✓ Applied change at line 42                 │',
    '│                                             │',
    '│ Note: old_string must be UNIQUE in file     │',
    '│ Include surrounding context if needed       │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ WRITE: Create or Overwrite ─────────────────┐',
    '│ Creates new files                           │',
    '│                                             │',
    '│ $ Write: src/hooks/useAuth.ts               │',
    '│   content: [new hook implementation]        │',
    '│                                             │',
    '│ ✓ Created new file (48 lines)               │',
    '│                                             │',
    '│ Warning: Overwrites existing files!         │',
    '│ Use Edit for modifications                  │',
    '└──────────────────────────────────────────────┘',
    '',
    '$ Read → understand → Edit (preferred)',
    '$ Write (only for new files)',
  ],

  'bash-tool': [
    '> Using Bash tool...',
    '',
    '┌─ Git Operations ─────────────────────────────┐',
    '│ $ Bash: git status                          │',
    '│                                             │',
    '│ On branch feature/auth                      │',
    '│ Changes not staged:                         │',
    '│   modified: src/auth/login.ts               │',
    '│   modified: src/hooks/useAuth.ts            │',
    '│                                             │',
    '│ $ Bash: git add . && git commit -m "feat"   │',
    '│ ✓ [feature/auth abc123] feat: add auth      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Package Management ─────────────────────────┐',
    '│ $ Bash: npm test -- --coverage              │',
    '│                                             │',
    '│ PASS src/auth/login.test.ts                 │',
    '│ PASS src/hooks/useAuth.test.ts              │',
    '│ Coverage: 94.2%                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ What NOT to use Bash for ───────────────────┐',
    '│ ✗ cat file.ts    → Use Read tool            │',
    '│ ✗ echo > file    → Use Write tool           │',
    '│ ✗ sed/awk        → Use Edit tool            │',
    '└──────────────────────────────────────────────┘',
  ],

  'search-tools': [
    '> Search Tools: Grep & Glob',
    '',
    '┌─ GREP: Search Content ───────────────────────┐',
    '│ Pattern: "AuthContext"                      │',
    '│ Type: tsx                                   │',
    '│                                             │',
    '│ src/contexts/AuthContext.tsx                │',
    '│   12: export const AuthContext = createC... │',
    '│   45: <AuthContext.Provider value={...}>    │',
    '│                                             │',
    '│ src/hooks/useAuth.ts                        │',
    '│   3: import { AuthContext } from \'../cont...│',
    '│   8: const ctx = useContext(AuthContext)    │',
    '│                                             │',
    '│ Found 4 matches in 2 files                  │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ GLOB: Find Files ───────────────────────────┐',
    '│ Pattern: "**/*.test.ts"                     │',
    '│                                             │',
    '│ src/auth/login.test.ts                      │',
    '│ src/hooks/useAuth.test.ts                   │',
    '│ src/components/Button.test.ts               │',
    '│ src/utils/validate.test.ts                  │',
    '│                                             │',
    '│ Found 4 files matching pattern              │',
    '└──────────────────────────────────────────────┘',
    '',
    'Grep: WHAT is inside files',
    'Glob: WHERE files are located',
  ],

  'task-tool': [
    '> Using Task tool (Subagent)...',
    '',
    '$ claude "analyze our auth implementation"',
    '',
    '> Spawning subagent: Explore',
    '',
    '┌─ Subagent Context ───────────────────────────┐',
    '│ Fresh 200K context window                   │',
    '│ Read: 23 files                              │',
    '│ Grep: 8 patterns                            │',
    '│ Analyzed: Authentication flow               │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Subagent complete. Returning summary...',
    '',
    '┌─ Summary Returned ───────────────────────────┐',
    '│ Auth implementation analysis:               │',
    '│                                             │',
    '│ ● JWT tokens with 24h expiry                │',
    '│ ● Refresh token rotation enabled            │',
    '│ ● Sessions stored in Redis                  │',
    '│ ● Middleware at: src/middleware/auth.ts     │',
    '│                                             │',
    '│ Recommendations:                            │',
    '│ ● Add rate limiting to login endpoint       │',
    '│ ● Consider shorter JWT expiry (1h)          │',
    '└──────────────────────────────────────────────┘',
    '',
    'Your main context: Only summary added (~200 tokens)',
    'Subagent explored: 23 files (~15,000 tokens)',
  ],

  // ==========================================================================
  // CHAPTER 4: THE ART OF INCANTATION (Prompting)
  // ==========================================================================

  'think-first': [
    '> Plan Mode (Shift+Tab twice)',
    '',
    '$ [Plan Mode activated]',
    '',
    '┌─ Phase 1: Exploration ───────────────────────┐',
    '│ > Reading project structure...              │',
    '│ > Analyzing existing patterns...            │',
    '│ > Identifying dependencies...               │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Phase 2: Plan Document ─────────────────────┐',
    '│ ## Implementation Plan                      │',
    '│                                             │',
    '│ ### Approach                                │',
    '│ Add pagination to fetchData() using         │',
    '│ existing API limit/offset params            │',
    '│                                             │',
    '│ ### Files to Modify                         │',
    '│ 1. src/services/api.ts - Add params         │',
    '│ 2. src/hooks/useData.ts - Handle pages      │',
    '│ 3. src/components/List.tsx - Add controls   │',
    '│                                             │',
    '│ ### Risks                                   │',
    '│ - Breaking change for existing callers      │',
    '│   → Mitigation: Default values              │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Waiting for your approval...',
    '> [Enter] to proceed, or provide feedback',
  ],

  'be-specific': [
    '> Prompt Specificity Comparison',
    '',
    '┌─ ✗ BAD: Vague Prompt ────────────────────────┐',
    '│ "Fix the login"                             │',
    '│                                             │',
    '│ > Claude response:                          │',
    '│   "Could you clarify what\'s wrong?          │',
    '│    - Not validating input?                  │',
    '│    - Error handling?                        │',
    '│    - Styling issues?                        │',
    '│    - API connection?"                       │',
    '│                                             │',
    '│ Wasted: ~500 tokens on clarification        │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ ✓ GOOD: Specific Prompt ────────────────────┐',
    '│ "In src/auth/login.ts, LoginForm doesn\'t    │',
    '│  validate email format before submission.   │',
    '│  Add email regex validation in handleSubmit │',
    '│  and show error message below email input." │',
    '│                                             │',
    '│ > Claude response:                          │',
    '│   [Immediately reads file and makes edit]   │',
    '│                                             │',
    '│ Saved: Direct to implementation             │',
    '└──────────────────────────────────────────────┘',
    '',
    'Specificity checklist:',
    '☐ File path',
    '☐ Function/component name',
    '☐ Current behavior',
    '☐ Desired behavior',
    '☐ Where to make change',
  ],

  'tell-not-to': [
    '> The Power of Constraints',
    '',
    '┌─ Without Constraints ────────────────────────┐',
    '│ "Add email validation to login"             │',
    '│                                             │',
    '│ Claude does:                                │',
    '│ ✓ Adds email validation (requested)         │',
    '│ + Refactors surrounding code                │',
    '│ + Adds TypeScript types everywhere          │',
    '│ + Adds comprehensive error handling         │',
    '│ + Creates new validation utility file       │',
    '│ + Updates 3 other files for consistency     │',
    '│                                             │',
    '│ Scope: 1 task → 6 changes                   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ With Constraints ───────────────────────────┐',
    '│ "Add email validation to login.             │',
    '│  DON\'T refactor other code.                 │',
    '│  DON\'T add types to unchanged lines.        │',
    '│  DON\'T modify any other files."             │',
    '│                                             │',
    '│ Claude does:                                │',
    '│ ✓ Adds email validation only                │',
    '│                                             │',
    '│ Scope: 1 task → 1 change                    │',
    '└──────────────────────────────────────────────┘',
    '',
    'Add constraints to CLAUDE.md for recurring ones:',
    '"Never refactor code I didn\'t ask about"',
  ],

  'give-context': [
    '> Context Transforms Quality',
    '',
    '┌─ Without Context ────────────────────────────┐',
    '│ "Add pagination"                            │',
    '│                                             │',
    '│ Claude assumes:                             │',
    '│ - Generic pagination component              │',
    '│ - Arbitrary page sizes                      │',
    '│ - No understanding of your scale            │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ With Context ───────────────────────────────┐',
    '│ "We\'re getting timeout errors in production │',
    '│  for users with large datasets (10K+ rows). │',
    '│  The fetchData function needs pagination.   │',
    '│  Our API already supports limit/offset.     │',
    '│  Keep backwards compatibility for existing  │',
    '│  callers that don\'t pass page params."      │',
    '│                                             │',
    '│ Claude understands:                         │',
    '│ ✓ Performance is the goal (not just UX)     │',
    '│ ✓ 10K+ rows = needs efficient pagination    │',
    '│ ✓ API already supports it (just frontend)   │',
    '│ ✓ Must not break existing code              │',
    '└──────────────────────────────────────────────┘',
    '',
    'Context types:',
    '• WHY: User complaint, perf issue, tech debt',
    '• CONSTRAINTS: Can\'t change API, deadline',
    '• WHO: Internal tool vs public API',
    '• WHAT FAILED: Previous attempts',
  ],

  'iterate': [
    '> Iterative Refinement',
    '',
    '┌─ Attempt 1 ──────────────────────────────────┐',
    '│ Claude\'s edit changes API signature         │',
    '│                                             │',
    '│ Your response:                              │',
    '│ "That changes the API signature - existing  │',
    '│  callers would break. Keep the original     │',
    '│  params, add pagination as optional new     │',
    '│  params with sensible defaults."            │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Attempt 2 ──────────────────────────────────┐',
    '│ Structure good, but error handling missing  │',
    '│                                             │',
    '│ Your response:                              │',
    '│ "Good structure. The error handling on      │',
    '│  line 45 should throw instead of returning  │',
    '│  null - we handle errors at the component   │',
    '│  level."                                    │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Attempt 3 ──────────────────────────────────┐',
    '│ ✓ Implementation correct                    │',
    '└──────────────────────────────────────────────┘',
    '',
    'Each iteration ADDS context.',
    'Failed attempts inform the next one.',
    'DON\'T /clear and start over - iterate!',
  ],

  // ==========================================================================
  // CHAPTER 5: THE WAND RACK (Skills)
  // ==========================================================================

  'what-are-skills': [
    '> Skills: Domain Knowledge for Claude',
    '',
    '┌─ What is a Skill? ───────────────────────────┐',
    '│ A markdown file that teaches Claude how to  │',
    '│ do something specific to YOUR work          │',
    '│                                             │',
    '│ ~/.claude/skills/commit/SKILL.md            │',
    '│ .claude/skills/api-design/SKILL.md          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ How They Work ──────────────────────────────┐',
    '│ 1. You create SKILL.md files                │',
    '│ 2. Claude loads skill descriptions at start │',
    '│ 3. When task matches, full skill loads      │',
    '│ 4. Claude follows skill instructions        │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Example triggers:',
    '',
    '$ "help me write a commit message"',
    '  → commit-messages skill activates',
    '',
    '$ "create a new API endpoint"',
    '  → api-design skill activates',
    '',
    '$ "review this PR for security"',
    '  → security-review skill activates',
    '',
    'Skills live in:',
    '  ~/.claude/skills/     (personal)',
    '  .claude/skills/       (team, in git)',
  ],

  'skill-structure': [
    '> Skill File Structure',
    '',
    '$ cat ~/.claude/skills/commit/SKILL.md',
    '',
    '---',
    'name: commit-messages',
    'description: Generate commit messages following',
    '  our team\'s conventions. Use when creating',
    '  commits or helping with commit messages.',
    '---',
    '',
    '# Commit Message Format',
    '',
    'All commits follow conventional commits:',
    '- feat: New feature for users',
    '- fix: Bug fix for users',
    '- refactor: Code change (no behavior change)',
    '- docs: Documentation only',
    '- test: Adding or updating tests',
    '',
    '## Format',
    '',
    '`type(scope): imperative description`',
    '',
    '## Examples',
    '',
    'Good:',
    '  feat(auth): add password reset flow',
    '  fix(cart): prevent negative quantities',
    '',
    'Bad:',
    '  Fixed stuff',
    '  WIP',
    '  Update code',
    '',
    '───────────────────────────────────────────────',
    'CRITICAL: The description determines',
    'when Claude applies this skill!',
  ],

  'progressive-disclosure': [
    '> Progressive Disclosure',
    '',
    '┌─ At Startup ─────────────────────────────────┐',
    '│ Claude loads ONLY skill metadata:           │',
    '│                                             │',
    '│ ┌ commit-messages ─────────────────────┐    │',
    '│ │ desc: "Generate commits..." (~20 tok)│    │',
    '│ └──────────────────────────────────────┘    │',
    '│ ┌ api-design ──────────────────────────┐    │',
    '│ │ desc: "Design REST APIs..." (~25 tok)│    │',
    '│ └──────────────────────────────────────┘    │',
    '│ ┌ security-review ─────────────────────┐    │',
    '│ │ desc: "Review for vuln..." (~30 tok) │    │',
    '│ └──────────────────────────────────────┘    │',
    '│                                             │',
    '│ Total: ~75 tokens for 3 skills              │',
    '│ (Full content: ~3,000 tokens)               │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ When Triggered ─────────────────────────────┐',
    '│ User: "help me write a commit"              │',
    '│                                             │',
    '│ > Skill matched: commit-messages            │',
    '│ > Loading full skill content...             │',
    '│ > +800 tokens added to context              │',
    '│                                             │',
    '│ Claude now has complete instructions        │',
    '└──────────────────────────────────────────────┘',
    '',
    'Result: 50 skills = ~1000 tokens at startup',
    '        Only triggered skills use full context',
  ],

  'skill-examples': [
    '> Real-World Skill Examples',
    '',
    '┌─ Database Queries ───────────────────────────┐',
    '│ name: db-patterns                           │',
    '│ desc: "Our PostgreSQL patterns..."          │',
    '│                                             │',
    '│ Content: Schema info, common joins,         │',
    '│ index hints, performance patterns           │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Code Review ────────────────────────────────┐',
    '│ name: review-checklist                      │',
    '│ desc: "Team code review standards..."       │',
    '│                                             │',
    '│ Content: Security checks, perf checks,      │',
    '│ style guide, test requirements              │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Meeting Notes ──────────────────────────────┐',
    '│ name: meeting-format                        │',
    '│ desc: "Structure meeting notes..."          │',
    '│                                             │',
    '│ Content: Template, attendee format,         │',
    '│ action item syntax, follow-up tags          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ API Design ─────────────────────────────────┐',
    '│ name: api-conventions                       │',
    '│ desc: "REST API design patterns..."         │',
    '│                                             │',
    '│ Content: URL patterns, error formats,       │',
    '│ auth headers, versioning scheme             │',
    '└──────────────────────────────────────────────┘',
    '',
    'Skills work for ANYTHING you explain repeatedly',
  ],

  'skill-triggers': [
    '> Skill Trigger Testing',
    '',
    '┌─ Test Different Phrasings ───────────────────┐',
    '│ $ "write a commit message"                  │',
    '│   → ✓ commit-messages skill triggered       │',
    '│                                             │',
    '│ $ "help me commit this"                     │',
    '│   → ✓ commit-messages skill triggered       │',
    '│                                             │',
    '│ $ "what should the commit say?"             │',
    '│   → ✗ Not triggered (too vague)             │',
    '│   → Fix: Add "commit message" to desc       │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Force Trigger ──────────────────────────────┐',
    '│ $ "utilize commit-messages skill"           │',
    '│   → Always triggers explicitly              │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Check Available Skills ─────────────────────┐',
    '│ $ "What skills do you have?"                │',
    '│                                             │',
    '│ > Available skills:                         │',
    '│   • commit-messages                         │',
    '│   • api-design                              │',
    '│   • security-review                         │',
    '│   • meeting-notes                           │',
    '└──────────────────────────────────────────────┘',
    '',
    'Description tips:',
    '- Include all trigger phrases',
    '- Be specific about WHEN to apply',
    '- Test with real prompts',
  ],

  // ==========================================================================
  // CHAPTER 6: THE SUMMONING SANCTUM (Subagents)
  // ==========================================================================

  'what-are-subagents': [
    '> Subagents: Fresh Context Windows',
    '',
    '┌─ Main Conversation ──────────────────────────┐',
    '│ Your 200K context window                    │',
    '│ Contains: All your messages + tool results  │',
    '│ Usage: ~45% (90K tokens)                    │',
    '│                                             │',
    '│ Problem: Reading 30 more files would        │',
    '│ push to dangerous 75%+ territory            │',
    '└──────────────────────────────────────────────┘',
    '',
    '               ↓ Spawn subagent',
    '',
    '┌─ Subagent Context ───────────────────────────┐',
    '│ FRESH 200K context window                   │',
    '│ Contains: Only the delegated task           │',
    '│ Usage: ~5% (starting fresh)                 │',
    '│                                             │',
    '│ Can: Read 30 files without affecting        │',
    '│ your main conversation                      │',
    '└──────────────────────────────────────────────┘',
    '',
    '               ↓ Returns summary',
    '',
    '┌─ Main Conversation ──────────────────────────┐',
    '│ Usage: ~46% (only summary added)            │',
    '│ Got: Distilled knowledge from 30 files      │',
    '│ Added: ~200 tokens (the summary)            │',
    '└──────────────────────────────────────────────┘',
  ],

  'builtin-spirits': [
    '> Built-in Subagent Types',
    '',
    '┌─ EXPLORE (Scout Spirit) ─────────────────────┐',
    '│ Purpose: Fast codebase exploration          │',
    '│ Tools: Read, Grep, Glob (read-only)         │',
    '│ Model: Claude Haiku (fast, cheap)           │',
    '│                                             │',
    '│ Use for:                                    │',
    '│ • "Where is X implemented?"                 │',
    '│ • "Find all uses of Y"                      │',
    '│ • "Map the auth flow"                       │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ PLAN (Sage Spirit) ─────────────────────────┐',
    '│ Purpose: Research for planning              │',
    '│ Tools: Read, Grep, Glob (read-only)         │',
    '│ Model: Claude Opus (deep reasoning)         │',
    '│                                             │',
    '│ Use for:                                    │',
    '│ • Architectural decisions                   │',
    '│ • Understanding complex systems             │',
    '│ • Trade-off analysis                        │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ GENERAL-PURPOSE (Battle Mage) ──────────────┐',
    '│ Purpose: Multi-step implementation          │',
    '│ Tools: All tools                            │',
    '│ Model: Claude Sonnet (balanced)             │',
    '│                                             │',
    '│ Use for:                                    │',
    '│ • "Implement this feature in isolation"     │',
    '│ • "Refactor this module"                    │',
    '│ • Complex multi-file changes                │',
    '└──────────────────────────────────────────────┘',
  ],

  'delegation-pattern': [
    '> Delegation & Return Pattern',
    '',
    '$ claude "research auth best practices',
    '          and implement password reset"',
    '',
    '> Main agent reasoning:',
    '  "This needs research + implementation.',
    '   I\'ll delegate research first."',
    '',
    '┌─ Delegation ─────────────────────────────────┐',
    '│ > Spawning: Explore subagent                │',
    '│ > Task: "Find auth patterns in codebase,    │',
    '│          identify password reset location"  │',
    '│                                             │',
    '│   [Subagent reads 15 files privately]       │',
    '│                                             │',
    '│ > Summary returned:                         │',
    '│   "Auth in src/auth/, password reset        │',
    '│    should go in src/auth/reset.ts           │',
    '│    Pattern: Express + JWT + nodemailer"     │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Main agent continues:',
    '  "Now I understand the patterns.',
    '   Implementing password reset..."',
    '',
    '> Edit: src/auth/reset.ts',
    '> Edit: src/routes/auth.ts',
    '> Write: src/auth/reset.test.ts',
    '',
    '───────────────────────────────────────────────',
    'Subagent: Explored 15 files (~10K tokens)',
    'Main context: Received ~150 token summary',
  ],

  'context-isolation': [
    '> Context Isolation',
    '',
    '┌─ Main Context ───────────────────────────────┐',
    '│                                             │',
    '│  Your conversation                          │',
    '│  ┌─────────────────────────────────────┐    │',
    '│  │ Messages, tool results, decisions   │    │',
    '│  │ Current: 85K tokens                 │    │',
    '│  └─────────────────────────────────────┘    │',
    '│                                             │',
    '│  Subagent summaries only:                   │',
    '│  ┌─────────────────────────────────────┐    │',
    '│  │ "Auth uses JWT, files in src/auth"  │    │',
    '│  │ Added: 150 tokens                   │    │',
    '│  └─────────────────────────────────────┘    │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Subagent Context (Disposed) ────────────────┐',
    '│                                             │',
    '│  ┌─────────────────────────────────────┐    │',
    '│  │ Read: auth/login.ts (200 lines)     │    │',
    '│  │ Read: auth/session.ts (150 lines)   │    │',
    '│  │ Read: auth/jwt.ts (180 lines)       │    │',
    '│  │ Read: middleware/auth.ts (100 lines)│    │',
    '│  │ ... 11 more files ...               │    │',
    '│  │ Total: ~15,000 tokens               │    │',
    '│  └─────────────────────────────────────┘    │',
    '│                                             │',
    '│  [Context discarded after summary]          │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    'You get the knowledge without the weight.',
  ],

  'custom-familiars': [
    '> Creating Custom Subagents',
    '',
    '$ cat .claude/agents/security-reviewer.md',
    '',
    '---',
    'name: security-reviewer',
    'description: Reviews code for security',
    '  vulnerabilities and OWASP top 10 issues.',
    'tools: Read, Grep, Glob',
    '---',
    '',
    'You are a security-focused code reviewer.',
    '',
    'When analyzing code, check for:',
    '1. Authentication/authorization gaps',
    '2. Injection vulnerabilities (SQL, XSS)',
    '3. Data exposure risks',
    '4. Insecure dependencies',
    '5. Hardcoded secrets',
    '',
    'Output format:',
    '- CRITICAL: Immediate action required',
    '- HIGH: Should fix before merge',
    '- MEDIUM: Consider fixing',
    '- LOW: Nice to have',
    '',
    '───────────────────────────────────────────────',
    'Locations:',
    '  ~/.claude/agents/    (personal)',
    '  .claude/agents/      (team, in git)',
    '',
    '$ /agents             # List available agents',
  ],

  'subagent-patterns': [
    '> Subagent Patterns',
    '',
    '┌─ Pattern 1: Research Before Action ──────────┐',
    '│ 1. Spawn Explore to understand codebase     │',
    '│ 2. Receive summary of findings              │',
    '│ 3. Make informed edits in main context      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Pattern 2: Parallel Review Pipeline ────────┐',
    '│ Spawn multiple reviewers simultaneously:    │',
    '│                                             │',
    '│ ┌───────────┐  ┌───────────┐  ┌───────────┐ │',
    '│ │ Security  │  │ Style     │  │ Test Cov  │ │',
    '│ │ Reviewer  │  │ Checker   │  │ Analyzer  │ │',
    '│ └─────┬─────┘  └─────┬─────┘  └─────┬─────┘ │',
    '│       └──────────────┼──────────────┘       │',
    '│                      ↓                      │',
    '│              Main synthesizes               │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Pattern 3: Scoped Implementation ───────────┐',
    '│ Main: "Refactor auth" (too big)             │',
    '│ → Subagent 1: "Refactor login.ts"           │',
    '│ → Subagent 2: "Refactor session.ts"         │',
    '│ → Subagent 3: "Update tests"                │',
    '│ Each returns: "Done, changed X lines"       │',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 7: THE PORTAL NEXUS (MCP)
  // ==========================================================================

  'what-is-mcp': [
    '> MCP: Model Context Protocol',
    '',
    '┌─ What It Does ───────────────────────────────┐',
    '│ Connects Claude to external services:       │',
    '│                                             │',
    '│   Claude  ←→  MCP Server  ←→  Service       │',
    '│                                             │',
    '│ Examples:                                   │',
    '│   Claude  ←→  github MCP  ←→  GitHub API    │',
    '│   Claude  ←→  slack MCP   ←→  Slack API     │',
    '│   Claude  ←→  postgres    ←→  Database      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Why It Matters ─────────────────────────────┐',
    '│ WITHOUT MCP:                                │',
    '│   1. Ask Claude what to do                  │',
    '│   2. Switch to GitHub, create issue         │',
    '│   3. Switch to Slack, post update           │',
    '│   4. Switch back to Claude...               │',
    '│                                             │',
    '│ WITH MCP:                                   │',
    '│   1. "Create GitHub issue and post to Slack"│',
    '│   2. Done. No context switching.            │',
    '└──────────────────────────────────────────────┘',
    '',
    '> MCP eliminates context switching',
    '> Work stays in flow state',
  ],

  'connecting-services': [
    '> Adding MCP Connections',
    '',
    '┌─ Via CLI ────────────────────────────────────┐',
    '│ # Basic HTTP connection                     │',
    '│ $ claude mcp add github                     │',
    '│ > Connecting to github MCP server...        │',
    '│ > ✓ 12 tools now available                  │',
    '│                                             │',
    '│ # With authentication                       │',
    '│ $ claude mcp add github \\                   │',
    '│     --header "Authorization: Bearer $TOKEN" │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Via Settings ───────────────────────────────┐',
    '│ Settings → Connectors → GitHub              │',
    '│                                             │',
    '│ ┌──────────────────────────────────────┐    │',
    '│ │ GitHub MCP                           │    │',
    '│ │ ○ Not connected                      │    │',
    '│ │                                      │    │',
    '│ │ [Configure] [Connect]                │    │',
    '│ └──────────────────────────────────────┘    │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Check Current Connections ──────────────────┐',
    '│ $ /mcp                                      │',
    '│                                             │',
    '│ Connected servers:                          │',
    '│ ● github      12 tools                      │',
    '│ ● slack        6 tools                      │',
    '│ ● postgres     5 tools                      │',
    '└──────────────────────────────────────────────┘',
  ],

  'portal-examples': [
    '> MCP in Action',
    '',
    '┌─ GitHub Integration ─────────────────────────┐',
    '│ $ "Implement the feature in issue #142"     │',
    '│                                             │',
    '│ > MCP: github.get_issue(142)                │',
    '│ > Reading issue description...              │',
    '│ > Understanding requirements...             │',
    '│ > [implements feature]                      │',
    '│ > MCP: github.create_pr(branch, body)       │',
    '│ > ✓ PR #156 created                         │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Database Queries ───────────────────────────┐',
    '│ $ "Find users who signed up this week"      │',
    '│                                             │',
    '│ > MCP: postgres.query(                      │',
    '│     "SELECT * FROM users                    │',
    '│      WHERE created_at > NOW() - \'7 days\'"   │',
    '│   )                                         │',
    '│ > Found 847 users                           │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Slack Updates ──────────────────────────────┐',
    '│ $ "Post the deployment summary to #releases"│',
    '│                                             │',
    '│ > MCP: slack.post_message(                  │',
    '│     channel: "releases",                    │',
    '│     text: "v2.4.1 deployed..."              │',
    '│   )                                         │',
    '│ > ✓ Message posted                          │',
    '└──────────────────────────────────────────────┘',
  ],

  'chain-workflows': [
    '> Chained MCP Workflow',
    '',
    '$ "Check the latest Jira ticket, implement it,',
    '   and update the team in Slack"',
    '',
    '> Step 1: Jira MCP',
    '  Fetching latest assigned ticket...',
    '  JIRA-4521: "Add retry logic to payments"',
    '',
    '> Step 2: Codebase',
    '  Reading src/services/payments.ts...',
    '  Adding retry logic with exponential backoff...',
    '',
    '> Step 3: Testing',
    '  Running npm test...',
    '  ✓ All tests passing',
    '',
    '> Step 4: Git',
    '  Creating branch: feature/payment-retry',
    '  Committing changes...',
    '  Creating PR #203',
    '',
    '> Step 5: Jira MCP',
    '  Updating JIRA-4521 status: "In Review"',
    '  Adding PR link to ticket',
    '',
    '> Step 6: Slack MCP',
    '  Posting to #engineering:',
    '  "PR #203 ready for review - payment retry"',
    '',
    '───────────────────────────────────────────────',
    '6 services. 1 prompt. Zero context switching.',
  ],

  'mcp-safety': [
    '> MCP Security Considerations',
    '',
    '┌─ Official Connectors (Recommended) ──────────┐',
    '│ ● GitHub    - Official, verified            │',
    '│ ● Slack     - Official, verified            │',
    '│ ● Google    - Official, verified            │',
    '│ ● PostgreSQL - Standard, audited            │',
    '│ ● Linear    - Official, verified            │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Third-Party Connectors ─────────────────────┐',
    '│ ⚠ NOT verified by Anthropic                 │',
    '│                                             │',
    '│ Before using:                               │',
    '│ • Review source code on GitHub              │',
    '│ • Check what permissions requested          │',
    '│ • Prefer connectors from known vendors      │',
    '│ • Use minimal permissions possible          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Security Commands ──────────────────────────┐',
    '│ $ /mcp                    # List connections │',
    '│ $ claude mcp remove NAME  # Disconnect      │',
    '│ $ claude mcp permissions  # View perms      │',
    '└──────────────────────────────────────────────┘',
    '',
    'Rule: Would you give this service your API key?',
    'If no → don\'t connect it to MCP',
  ],

  'compound-effect': [
    '> The Compound Effect',
    '',
    '┌─ Skills ─────────────────────────────────────┐',
    '│ Encode your patterns and conventions        │',
    '│ → Claude knows HOW to do things your way    │',
    '└─────────────────────┬────────────────────────┘',
    '                      │',
    '┌─ Subagents ─────────┼────────────────────────┐',
    '│ Delegate without    │ context pollution      │',
    '│ → Complex tasks stay manageable             │',
    '└─────────────────────┼────────────────────────┘',
    '                      │',
    '┌─ MCP ───────────────┼────────────────────────┐',
    '│ Connect external    │ services               │',
    '│ → No context switching, flow state          │',
    '└─────────────────────┼────────────────────────┘',
    '                      ↓',
    '',
    '┌─ Together ───────────────────────────────────┐',
    '│ "Implement JIRA-4521 following our API      │',
    '│  patterns, have security review it, then    │',
    '│  post update to Slack"                      │',
    '│                                             │',
    '│ • api-patterns skill → knows conventions    │',
    '│ • security-reviewer agent → isolated review │',
    '│ • jira/slack MCP → seamless integration     │',
    '│                                             │',
    '│ One prompt. Minutes of work. Quality output.│',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 8: BREAKING THE LOOP (Troubleshooting)
  // ==========================================================================

  'breaking-loops': [
    '> Breaking Stuck Loops',
    '',
    '┌─ Signs of a Loop ────────────────────────────┐',
    '│ ✗ Same error 3+ times                       │',
    '│ ✗ "Let me try that again..."                │',
    '│ ✗ Repeating similar approaches              │',
    '│ ✗ Claude apologizing repeatedly             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ DON\'T Do This ──────────────────────────────┐',
    '│ ✗ Explain more (if 3 explanations failed,   │',
    '│   the 4th won\'t help)                       │',
    '│ ✗ Just repeat the same request              │',
    '│ ✗ Add more words to the prompt              │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ DO This ────────────────────────────────────┐',
    '│ $ /clear                                    │',
    '│ > Context cleared. Fresh start.             │',
    '│                                             │',
    '│ Then try:                                   │',
    '│ • Simpler version of the task               │',
    '│ • Different framing entirely                │',
    '│ • Minimal working example                   │',
    '│ • Break into smaller steps                  │',
    '└──────────────────────────────────────────────┘',
    '',
    'If Claude struggles, the task decomposition',
    'is wrong - not the explanation quality.',
  ],

  'reframing': [
    '> Three Reframing Strategies',
    '',
    '┌─ 1. Change Abstraction Level ────────────────┐',
    '│ Too high-level:                             │',
    '│   "Fix the authentication"                  │',
    '│                                             │',
    '│ More specific:                              │',
    '│   "In src/auth/login.ts line 45, the        │',
    '│    validateToken function returns null      │',
    '│    instead of throwing on invalid tokens"   │',
    '│                                             │',
    '│ Or zoom out:                                │',
    '│   "I need users to stay logged in longer"   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 2. Change Starting Point ───────────────────┐',
    '│ Instead of:                                 │',
    '│   "Modify this function to add caching"     │',
    '│                                             │',
    '│ Try:                                        │',
    '│   "Here\'s what the function should do:      │',
    '│    [full specification]. Rewrite it."       │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 3. Relax Constraints Temporarily ───────────┐',
    '│ If stuck on:                                │',
    '│   "Add feature X without changing the API"  │',
    '│                                             │',
    '│ Try:                                        │',
    '│   "How would you add X if you COULD change  │',
    '│    the API? What\'s the ideal approach?"     │',
    '│                                             │',
    '│ Then: Work backwards to constraints         │',
    '└──────────────────────────────────────────────┘',
  ],

  'input-quality': [
    '> The Input Quality Mirror',
    '',
    '┌─ Vague Input → Vague Output ─────────────────┐',
    '│ "Make it better"                            │',
    '│                                             │',
    '│ Claude: "Could you specify what aspect      │',
    '│ you\'d like improved? Performance? UX?       │',
    '│ Readability? Error handling? Testing?"      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Contradictory → Confused ───────────────────┐',
    '│ "Add comprehensive error handling but       │',
    '│  keep the function under 10 lines"          │',
    '│                                             │',
    '│ Claude: [tries both, achieves neither]      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Missing Context → Hallucinated ─────────────┐',
    '│ "Update the payment flow"                   │',
    '│                                             │',
    '│ Claude: [invents a payment flow that        │',
    '│  doesn\'t match your actual system]          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Quality Checklist ──────────────────────────┐',
    '│ ☐ Is my prompt specific enough?             │',
    '│ ☐ Did I provide necessary context?          │',
    '│ ☐ Are my constraints compatible?            │',
    '│ ☐ Have I tried showing vs telling?          │',
    '└──────────────────────────────────────────────┘',
  ],

  'escape-hatches': [
    '> Emergency Controls',
    '',
    '┌─ Interrupt Operations ───────────────────────┐',
    '│ [Escape]        Stop current operation      │',
    '│ [Escape][Esc]   Exit Claude Code entirely   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Undo Changes ───────────────────────────────┐',
    '│ $ /undo                                     │',
    '│ > Reverted: src/auth/login.ts               │',
    '│ > Reverted: src/hooks/useAuth.ts            │',
    '│ > 2 files restored                          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Git Safety Net ─────────────────────────────┐',
    '│ Before risky experiments:                   │',
    '│ $ git stash                                 │',
    '│                                             │',
    '│ If things go wrong:                         │',
    '│ $ git stash pop       # Restore             │',
    '│ $ git checkout .      # Nuclear option      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Fresh Context ──────────────────────────────┐',
    '│ $ /clear                                    │',
    '│ > Conversation cleared                      │',
    '│ > CLAUDE.md still loaded                    │',
    '│ > Ready for fresh start                     │',
    '└──────────────────────────────────────────────┘',
    '',
    'You always have control.',
    'Escape → Undo → Git → /clear',
  ],

  'conclusion': [
    '> Your Claude Code Mastery',
    '',
    '┌─ The Foundations ────────────────────────────┐',
    '│ ● Agentic Loop    - Prompt → Act → Repeat   │',
    '│ ● Context Window  - 200K tokens, use wisely │',
    '│ ● CLAUDE.md       - Your persistent memory  │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ The Tools ──────────────────────────────────┐',
    '│ ● Read/Edit/Write - File operations         │',
    '│ ● Bash            - Shell commands          │',
    '│ ● Grep/Glob       - Search & find           │',
    '│ ● Task/Todo       - Subagents & tracking    │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ The Multipliers ────────────────────────────┐',
    '│ ● Skills          - Domain knowledge        │',
    '│ ● Subagents       - Context isolation       │',
    '│ ● MCP             - External connections    │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ The Commands ───────────────────────────────┐',
    '│ /clear   - Fresh context                    │',
    '│ /compact - Compress context                 │',
    '│ /model   - Switch models                    │',
    '│ /undo    - Revert changes                   │',
    '│ /mcp     - View connections                 │',
    '│ /agents  - List subagents                   │',
    '└──────────────────────────────────────────────┘',
    '',
    'The magic is yours to wield. Go create.',
  ],
}

/**
 * Get beat-specific terminal content, or return undefined to fall back to mode-based content.
 */
export function getBeatTerminalContent(beatId: string): string[] | undefined {
  return BEAT_TERMINAL_CONTENT[beatId]
}

// ============================================================================
// PRACTICAL EXAMPLE CONTENT
// Hands-on demonstrations showing realistic Claude Code implementation scenarios
// ============================================================================

/**
 * Maps story beat IDs to practical example terminal output arrays.
 * Shows realistic Claude Code implementation scenarios (not dumbed down).
 */
export const BEAT_EXAMPLE_CONTENT: Record<string, string[]> = {
  // ==========================================================================
  // CHAPTER 1: THE ARCANE LOOP (Agent Architecture)
  // ==========================================================================

  'what-is-agentic': [
    '$ claude "There\'s a race condition in useCart.ts',
    '  where addItem fires before cart initializes"',
    '',
    '> Analyzing the issue...',
    '',
    '> Using Read tool...',
    '  src/hooks/useCart.ts (128 lines)',
    '',
    '┌─ Issue Found ───────────────────────────────┐',
    '│ Line 34: addItem() mutates cartRef.current  │',
    '│ Line 12: cartRef initialized async in       │',
    '│          useEffect after first render       │',
    '│ Problem: Race if addItem called immediately │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Using Edit tool...',
    '  src/hooks/useCart.ts',
    '',
    '  + const [isReady, setIsReady] = useState(false);',
    '  + ',
    '  + async function ensureReady() {',
    '  +   if (!isReady) await initPromise.current;',
    '  + }',
    '  + ',
    '    async function addItem(item: CartItem) {',
    '  +   await ensureReady();',
    '      cartRef.current.items.push(item);',
    '',
    '> Using Bash tool...',
    '  npm test -- --testPathPattern=useCart',
    '',
    '  PASS src/hooks/useCart.test.ts',
    '  ✓ adds item after init (45ms)',
    '  ✓ handles concurrent adds (52ms)',
    '  ✓ queues adds during init (38ms)',
    '',
    '✓ Race condition fixed. Hook now awaits init.',
  ],

  'the-loop': [
    '$ claude "convert utils/format.js to TypeScript"',
    '',
    '┌─ API Call #1 ───────────────────────────────┐',
    '│ Input: system + user_prompt                 │',
    '│ Model decides: Need to read file first      │',
    '│ Response: tool_use (Read)                   │',
    '└──────────────────────────────────────────────┘',
    '  → Reading utils/format.js...',
    '',
    '┌─ API Call #2 ───────────────────────────────┐',
    '│ Input: previous + tool_result (file content)│',
    '│ Model decides: Create typed version         │',
    '│ Response: tool_use (Write)                  │',
    '└──────────────────────────────────────────────┘',
    '  → Creating utils/format.ts...',
    '',
    '┌─ API Call #3 ───────────────────────────────┐',
    '│ Input: previous + tool_result (success)     │',
    '│ Model decides: Verify types compile         │',
    '│ Response: tool_use (Bash)                   │',
    '└──────────────────────────────────────────────┘',
    '  → Running: npx tsc utils/format.ts --noEmit',
    '',
    '┌─ API Call #4 ───────────────────────────────┐',
    '│ Input: previous + tool_result (tsc output)  │',
    '│ Model decides: Task complete, respond       │',
    '│ Response: end_turn                          │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'Total: 4 iterations, ~8,500 tokens consumed',
    'Each iteration = full context reconstruction',
  ],

  'model-is-80': [
    '$ claude "checkout has too many steps"',
    '',
    '> (Model reasoning - you don\'t see this):',
    '  "User reports UX concern. Need to understand',
    '   current flow before suggesting changes.',
    '   Let me explore the checkout implementation."',
    '',
    '> Using Grep tool...',
    '  Pattern: "checkout|step" in src/',
    '',
    '> Using Read tool...',
    '  src/pages/Checkout/index.tsx',
    '  src/pages/Checkout/steps/index.ts',
    '',
    '> (Model analysis):',
    '  "5 steps: Cart → Login → Shipping →',
    '   Payment → Review → Confirm',
    '   Industry avg is 3-4. Can consolidate."',
    '',
    '> Analysis complete:',
    '',
    '  Current flow (5 steps):',
    '    1. Cart Review',
    '    2. Login/Register',
    '    3. Shipping Address',
    '    4. Payment Method',
    '    5. Order Review',
    '',
    '  Proposed flow (3 steps):',
    '    1. Cart + Login (guest checkout option)',
    '    2. Shipping + Payment (single form)',
    '    3. Review + Confirm',
    '',
    '───────────────────────────────────────────────',
    'Simple prompt → Model decided entire approach',
  ],

  'model-selection': [
    '$ claude "should we use Zustand or Redux?"',
    '',
    '> [Sonnet] Quick response:',
    '  "Zustand is simpler with less boilerplate.',
    '   Redux has more tooling. Depends on scale."',
    '',
    '$ /model opus',
    '> Switched to Opus',
    '',
    '$ claude "analyze our codebase and recommend',
    '  state management with specific justification"',
    '',
    '> [Opus] Deep analysis:',
    '',
    '> Using Grep tool...',
    '  Pattern: "useState|useReducer|context"',
    '',
    '> Using Read tool...',
    '  src/contexts/*.tsx (5 files)',
    '  src/hooks/use*.ts (12 files)',
    '',
    '┌─ Recommendation: Zustand ───────────────────┐',
    '│                                             │',
    '│ Your codebase shows:                        │',
    '│ • 23 useState calls across contexts         │',
    '│ • 3 instances of prop drilling > 3 levels  │',
    '│ • No time-travel debugging requirements    │',
    '│ • Team size: 4 (visible from git log)      │',
    '│                                             │',
    '│ Zustand fits because:                       │',
    '│ • Minimal boilerplate matches your style   │',
    '│ • No middleware needs (no async complexity)│',
    '│ • Small team = less need for strict Redux  │',
    '│   patterns                                  │',
    '│                                             │',
    '│ Migration path:                             │',
    '│ • Start with CartContext (most prop drill) │',
    '│ • Keep AuthContext as-is (security audit)  │',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 2: THE ARCANE RESERVOIR (Context)
  // ==========================================================================

  'what-claude-sees': [
    '> Live token breakdown for this API call:',
    '',
    '┌─ SYSTEM PROMPT (~6,800 tokens) ─────────────┐',
    '│                                             │',
    '│ Base instructions           ~3,200 tokens  │',
    '│   └─ Tool usage rules, safety guidelines   │',
    '│                                             │',
    '│ Tool definitions (8 tools)  ~1,100 tokens  │',
    '│   └─ Read, Edit, Write, Bash, Grep, Glob,  │',
    '│      Task, TodoWrite schemas               │',
    '│                                             │',
    '│ CLAUDE.md (your project)    ~1,850 tokens  │',
    '│   └─ Build commands, architecture notes,   │',
    '│      coding conventions                    │',
    '│                                             │',
    '│ Active skill: api-patterns    ~650 tokens  │',
    '│   └─ Loaded because you mentioned "API"    │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ CONVERSATION HISTORY (~24,200 tokens) ─────┐',
    '│                                             │',
    '│ Turn 1: "analyze auth system"               │',
    '│   User message:                ~45 tokens  │',
    '│   Tool: Read src/auth/...   ~4,230 tokens  │',
    '│   Assistant response:         ~180 tokens  │',
    '│                                             │',
    '│ Turn 2: "refactor login flow"               │',
    '│   User message:                ~32 tokens  │',
    '│   Tool: Edit (3 files)      ~1,890 tokens  │',
    '│   Tool: Bash npm test         ~420 tokens  │',
    '│   Assistant response:         ~210 tokens  │',
    '│                                             │',
    '│ ... 4 more turns ...       ~17,193 tokens  │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ YOUR NEW MESSAGE ──────────────────────────┐',
    '│ "now add password reset"       ~28 tokens  │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'Total: ~31,028 tokens (15.5% of 200K window)',
  ],

  'context-degrades': [
    '> Real session showing degradation:',
    '',
    '┌─ Turn 1 (8% context) ───────────────────────┐',
    '│ You: "Add user authentication to the app"  │',
    '│                                             │',
    '│ Claude: Creates comprehensive auth system  │',
    '│ • JWT with refresh tokens                  │',
    '│ • Secure httpOnly cookies                  │',
    '│ • CSRF protection                          │',
    '│                                             │',
    '│ Quality: ████████████ Excellent            │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Turn 8 (34% context) ──────────────────────┐',
    '│ You: "Add role-based permissions"          │',
    '│                                             │',
    '│ Claude: Implements RBAC but...             │',
    '│ • Slightly different token structure       │',
    '│ • Missed existing permission helper        │',
    '│ • Created duplicate validation logic       │',
    '│                                             │',
    '│ Quality: ████████░░░░ Good (minor issues)  │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Turn 15 (58% context) ─────────────────────┐',
    '│ You: "Add audit logging for admin actions" │',
    '│                                             │',
    '│ Claude: Implementation has issues...       │',
    '│ • Forgot auth middleware from Turn 1       │',
    '│ • Wrong import paths                       │',
    '│ • Duplicated existing logger               │',
    '│                                             │',
    '│ Quality: ████░░░░░░░░ Needs corrections    │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    '> Should have used /compact at Turn 8',
    '> Or /clear and started fresh task',
  ],

  'claudemd-memory': [
    '> Same prompt, different CLAUDE.md:',
    '',
    '┌─ Without CLAUDE.md ─────────────────────────┐',
    '│ $ claude "create a new API endpoint for    │',
    '│   user preferences"                        │',
    '│                                             │',
    '│ Claude creates:                            │',
    '│   /api/v1/preferences          (generic)   │',
    '│   Express.js default patterns              │',
    '│   Basic try/catch error handling           │',
    '│   No tests                                 │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ With CLAUDE.md ────────────────────────────┐',
    '│ $ cat CLAUDE.md                            │',
    '│                                             │',
    '│   ## API Conventions                        │',
    '│   - Prefix: /api/v2/                        │',
    '│   - Errors: Use @company/errors package    │',
    '│   - Tests: Colocate as *.test.ts           │',
    '│   - Validation: Zod schemas in /schemas    │',
    '│                                             │',
    '│ $ claude "create a new API endpoint for    │',
    '│   user preferences"                        │',
    '│                                             │',
    '│ Claude creates:                            │',
    '│   /api/v2/preferences         (your style) │',
    '│   Uses @company/errors                     │',
    '│   preferences.test.ts included             │',
    '│   Zod schema in /schemas/preferences.ts    │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'CLAUDE.md persists YOUR patterns across',
    'every conversation and /clear.',
  ],

  'clear-and-compact': [
    '> When to use each:',
    '',
    '┌─ Scenario: 2 hours into refactoring ────────┐',
    '│                                             │',
    '│ $ /cost                                    │',
    '│   Context: 138,000 tokens (69%)            │',
    '│   ⚠ Performance may be degrading           │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Option A: /compact ────────────────────────┐',
    '│ Use when: You need continuity              │',
    '│                                             │',
    '│ $ /compact                                 │',
    '│   Analyzing 138,000 tokens...              │',
    '│                                             │',
    '│   Preserved context:                       │',
    '│   • Refactored AuthService (8 files)       │',
    '│   • Added UserPreferences entity           │',
    '│   • Decision: Chose Zustand over Redux     │',
    '│   • TODO: Still need to update tests       │',
    '│                                             │',
    '│   Before: 138,000 tokens                   │',
    '│   After:   24,500 tokens (82% reduction)   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Option B: /clear ──────────────────────────┐',
    '│ Use when: Starting unrelated work          │',
    '│                                             │',
    '│ $ /clear                                   │',
    '│   Conversation cleared.                    │',
    '│   CLAUDE.md retained.                      │',
    '│                                             │',
    '│   Context: 6,800 tokens (system only)      │',
    '│                                             │',
    '│ $ claude "Now let\'s work on the payment   │',
    '│   integration - completely separate task"  │',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 3: ENCHANTED ARTIFACTS (Tools)
  // ==========================================================================

  'tools-overview': [
    '> Tool selection for: "find auth validation"',
    '',
    '┌─ Claude\'s reasoning ────────────────────────┐',
    '│                                             │',
    '│ ✗ Read - Don\'t know which file yet        │',
    '│ ✗ Edit - Nothing to change yet            │',
    '│ ✗ Write - Not creating new files          │',
    '│ ✗ Bash - Not a shell command              │',
    '│ ✓ Grep - Search content for pattern       │',
    '│ ✗ Glob - Not looking for file names       │',
    '│ ✗ Task - Simple search, no subagent needed│',
    '│ ✗ Todo - Not tracking multiple tasks      │',
    '│                                             │',
    '│ Decision: Grep for "validate.*token"       │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Using Grep tool...',
    '  Pattern: validate.*token|tokenValidat',
    '  Type: ts',
    '',
    '  src/auth/jwt.ts:42       validateToken()',
    '  src/middleware/auth.ts:18  validateAccessToken',
    '  src/utils/tokens.ts:56   tokenValidator',
    '',
    '───────────────────────────────────────────────',
    '',
    '> Now Claude reasons:',
    '  "Found 3 files. Main logic likely in jwt.ts',
    '   line 42. Now I can use Read with focus."',
    '',
    '> Using Read tool...',
    '  src/auth/jwt.ts (lines 35-65)',
  ],

  'read-tool': [
    '$ claude "explain the payment retry logic"',
    '',
    '> Using Grep tool (find location first)...',
    '  Pattern: "retry|backoff" in src/services/',
    '',
    '  src/services/payment.ts:89   retryPayment()',
    '  src/services/payment.ts:112  backoffDelay()',
    '',
    '> Using Read tool (focused range)...',
    '  src/services/payment.ts (lines 85-130)',
    '',
    '   85│ const MAX_RETRIES = 3;',
    '   86│ const BASE_DELAY = 1000;',
    '   87│',
    '   88│ /**',
    '   89│  * Retry failed payments with exponential',
    '   90│  * backoff. Handles transient Stripe errors.',
    '   91│  */',
    '   92│ export async function retryPayment(',
    '   93│   paymentIntent: string,',
    '   94│   attempt = 0',
    '   95│ ): Promise<PaymentResult> {',
    '   96│   try {',
    '   97│     return await stripe.confirm(paymentIntent);',
    '   98│   } catch (err) {',
    '   99│     if (attempt >= MAX_RETRIES) throw err;',
    '  100│     if (!isTransientError(err)) throw err;',
    '  101│     ',
    '  102│     await delay(backoffDelay(attempt));',
    '  103│     return retryPayment(paymentIntent, attempt + 1);',
    '  104│   }',
    '  105│ }',
    '',
    '> Added ~600 tokens (focused read)',
    '> Full file would be ~2,400 tokens',
  ],

  'edit-write-tools': [
    '$ claude "change session timeout from 30 to 60 min"',
    '',
    '> Using Grep tool...',
    '  Pattern: "timeout|session.*exp|30"',
    '',
    '  src/config/auth.ts:12  sessionTimeout: 30',
    '',
    '> Using Read tool...',
    '  src/config/auth.ts',
    '',
    '> Using Edit tool...',
    '',
    '┌─ Edit: Surgical Replacement ────────────────┐',
    '│ File: src/config/auth.ts                   │',
    '│                                             │',
    '│ old_string:                                │',
    '│   sessionTimeout: 30, // minutes           │',
    '│                                             │',
    '│ new_string:                                │',
    '│   sessionTimeout: 60, // minutes           │',
    '│                                             │',
    '│ ✓ Applied at line 12                       │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    '',
    '$ claude "create a new rate limiter middleware"',
    '',
    '> Using Write tool...',
    '',
    '┌─ Write: New File ───────────────────────────┐',
    '│ File: src/middleware/rateLimit.ts          │',
    '│ Content: 45 lines                          │',
    '│ ✓ Created new file                         │',
    '│                                             │',
    '│ Note: Write overwrites! For existing files,│',
    '│ always use Edit for surgical changes.      │',
    '└──────────────────────────────────────────────┘',
  ],

  'bash-tool': [
    '$ claude "run tests and fix any failures"',
    '',
    '> Using Bash tool...',
    '  npm test',
    '',
    '  PASS src/utils/format.test.ts',
    '  PASS src/hooks/useAuth.test.ts',
    '  FAIL src/components/Cart.test.tsx',
    '',
    '  ● Cart › should update quantity on click',
    '',
    '    expect(received).toBe(expected)',
    '',
    '    Expected: 3',
    '    Received: 2',
    '',
    '      42 |   fireEvent.click(incrementBtn);',
    '      43 |   fireEvent.click(incrementBtn);',
    '    > 44 |   expect(quantity).toBe(3);',
    '',
    '> Using Read tool...',
    '  src/components/Cart.test.tsx (lines 38-50)',
    '',
    '> Using Read tool...',
    '  src/components/Cart.tsx (lines 60-80)',
    '',
    '> Found: updateQuantity uses stale closure',
    '',
    '> Using Edit tool...',
    '  src/components/Cart.tsx',
    '  - setQuantity(quantity + 1)',
    '  + setQuantity(prev => prev + 1)',
    '',
    '> Using Bash tool...',
    '  npm test -- --testPathPattern=Cart',
    '',
    '  PASS src/components/Cart.test.tsx',
    '  ✓ 8 tests passed',
  ],

  'search-tools': [
    '> Grep vs Glob - know the difference:',
    '',
    '┌─ GREP: Search CONTENT ───────────────────────┐',
    '│ "What files contain this pattern?"          │',
    '│                                             │',
    '│ $ claude "find where we handle 401 errors" │',
    '│                                             │',
    '│ > Using Grep tool...                        │',
    '│   Pattern: "401|unauthorized|Unauthorized"  │',
    '│   Type: ts,tsx                              │',
    '│                                             │',
    '│   src/api/client.ts:45                      │',
    '│     if (status === 401) handleUnauth();     │',
    '│   src/hooks/useApi.ts:23                    │',
    '│     case 401: return refreshAndRetry();     │',
    '│   src/middleware/auth.ts:67                 │',
    '│     throw new UnauthorizedError();          │',
    '│                                             │',
    '│   Found 3 matches                           │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ GLOB: Search FILENAMES ────────────────────┐',
    '│ "Where are files matching this pattern?"    │',
    '│                                             │',
    '│ $ claude "find all test files"             │',
    '│                                             │',
    '│ > Using Glob tool...                        │',
    '│   Pattern: "**/*.test.{ts,tsx}"             │',
    '│                                             │',
    '│   src/components/Cart.test.tsx              │',
    '│   src/hooks/useAuth.test.ts                 │',
    '│   src/utils/format.test.ts                  │',
    '│   src/api/client.test.ts                    │',
    '│                                             │',
    '│   Found 4 files                             │',
    '└──────────────────────────────────────────────┘',
  ],

  'task-tool': [
    '$ claude "analyze our entire auth system',
    '  and recommend security improvements"',
    '',
    '> Main context: 92,000 tokens (46%)',
    '> Task requires reading ~25 files',
    '> Reading directly would push to 75%+',
    '',
    '> Using Task tool (spawning subagent)...',
    '  Type: Explore',
    '  Prompt: "Map auth system, identify security gaps"',
    '',
    '┌─ Subagent (fresh 200K context) ─────────────┐',
    '│                                             │',
    '│ > Reading src/auth/*.ts (6 files)          │',
    '│ > Reading src/middleware/auth*.ts (3 files)│',
    '│ > Reading src/utils/crypto.ts              │',
    '│ > Reading src/config/security.ts           │',
    '│ > Grepping for "password|secret|token"     │',
    '│ > Reading src/routes/auth.ts               │',
    '│ ... analyzing 23 files total ...           │',
    '│                                             │',
    '│ Subagent context used: ~18,000 tokens      │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Subagent returns summary:',
    '',
    '┌─ Security Analysis Summary ─────────────────┐',
    '│ ✓ JWT implementation is solid              │',
    '│ ✓ Passwords hashed with bcrypt (cost 12)   │',
    '│ ⚠ CSRF tokens not rotated on login         │',
    '│ ⚠ Rate limiting missing on /auth/login    │',
    '│ ✗ Password reset tokens don\'t expire      │',
    '│                                             │',
    '│ Priority fixes:                            │',
    '│ 1. Add expiry to reset tokens (HIGH)       │',
    '│ 2. Rate limit login endpoint (HIGH)        │',
    '│ 3. Rotate CSRF on auth state change (MED)  │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Main context: 92,000 + 180 = 92,180 tokens',
    '  (Only summary added, not 25 files)',
  ],

  // ==========================================================================
  // CHAPTER 4: THE ART OF INCANTATION (Prompting)
  // ==========================================================================

  'think-first': [
    '$ # Press Shift+Tab twice to enter Plan Mode',
    '',
    '> [Plan Mode activated with Opus]',
    '',
    '$ claude "add real-time notifications"',
    '',
    '> Phase 1: Exploration',
    '',
    '> Using Grep tool...',
    '  Searching for existing WebSocket/SSE code...',
    '',
    '> Using Read tool...',
    '  src/services/api.ts',
    '  src/hooks/useSubscription.ts',
    '  package.json (checking dependencies)',
    '',
    '> Phase 2: Writing Plan',
    '',
    '┌─ ~/.claude/plans/notifications.md ──────────┐',
    '│                                             │',
    '│ ## Implementation Plan                      │',
    '│                                             │',
    '│ ### Approach                                │',
    '│ Use Server-Sent Events (SSE) over WebSocket │',
    '│ because:                                    │',
    '│ - Existing REST API (no WS infrastructure) │',
    '│ - One-way notifications (server → client)  │',
    '│ - Simpler reconnection handling            │',
    '│                                             │',
    '│ ### Files to Create/Modify                  │',
    '│ 1. src/services/notifications.ts (new)      │',
    '│ 2. src/hooks/useNotifications.ts (new)      │',
    '│ 3. server/routes/sse.ts (new)              │',
    '│ 4. src/components/NotificationBell.tsx     │',
    '│                                             │',
    '│ ### Risks                                   │',
    '│ - Need to handle reconnection on mobile    │',
    '│ - Consider notification permission prompt   │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Waiting for approval before implementing...',
  ],

  'be-specific': [
    '> Side-by-side comparison:',
    '',
    '┌─ VAGUE PROMPT ──────────────────────────────┐',
    '│                                             │',
    '│ $ claude "fix the login bug"               │',
    '│                                             │',
    '│ > Claude responds:                          │',
    '│   "I\'d like to help fix the login bug.     │',
    '│    Could you clarify:                       │',
    '│    - Which file contains the login code?   │',
    '│    - What\'s the current behavior?          │',
    '│    - What should happen instead?           │',
    '│    - Any error messages in console?"       │',
    '│                                             │',
    '│ Result: Wasted a turn on clarification     │',
    '│ Tokens spent: ~450 (question + response)   │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ SPECIFIC PROMPT ───────────────────────────┐',
    '│                                             │',
    '│ $ claude "In src/pages/Login.tsx,          │',
    '│   handleSubmit (line ~45) doesn\'t check    │',
    '│   if email is empty before calling the API.│',
    '│   Add validation to show \'Email required\'  │',
    '│   error if email field is blank."          │',
    '│                                             │',
    '│ > Claude immediately:                       │',
    '│   > Using Read tool... src/pages/Login.tsx │',
    '│   > Using Edit tool...                      │',
    '│     + if (!email.trim()) {                  │',
    '│     +   setError(\'Email required\');        │',
    '│     +   return;                             │',
    '│     + }                                     │',
    '│                                             │',
    '│ Result: Direct fix, no back-and-forth      │',
    '│ Tokens spent: ~280 (efficient)             │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
  ],

  'tell-not-to': [
    '$ claude "add email validation to the signup form"',
    '',
    '> WITHOUT constraints, Claude does:',
    '',
    '  ✓ Adds email validation (what you wanted)',
    '  + Refactors form to use react-hook-form',
    '  + Adds Zod schema for all fields',
    '  + Creates new ValidationMessage component',
    '  + Adds TypeScript types throughout',
    '  + Updates 3 related components for consistency',
    '  + Adds unit tests for validator',
    '',
    '  Files changed: 8',
    '  Lines modified: 340',
    '  You wanted: ~15 lines in 1 file',
    '',
    '───────────────────────────────────────────────',
    '',
    '$ claude "add email validation to the signup form.',
    '  DON\'T refactor the form library.',
    '  DON\'T add schemas for other fields.',
    '  DON\'T create new components.',
    '  DON\'T modify other files.',
    '  ONLY add the email check in handleSubmit."',
    '',
    '> WITH constraints, Claude does:',
    '',
    '  ✓ Adds email regex check in handleSubmit',
    '  ✓ Shows error below email field',
    '',
    '  Files changed: 1',
    '  Lines modified: 12',
    '',
    '───────────────────────────────────────────────',
    'Add frequent constraints to CLAUDE.md',
  ],

  'give-context': [
    '> Context transforms Claude\'s approach:',
    '',
    '┌─ WITHOUT context ───────────────────────────┐',
    '│ $ claude "add caching to getUserById"      │',
    '│                                             │',
    '│ Claude implements:                         │',
    '│ • In-memory Map cache                      │',
    '│ • 5-minute TTL (arbitrary)                 │',
    '│ • No invalidation strategy                 │',
    '│                                             │',
    '│ Generic solution, may not fit your needs   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ WITH context ──────────────────────────────┐',
    '│ $ claude "getUserById is called 50x/page   │',
    '│   causing N+1 queries. We use Redis for    │',
    '│   sessions already. User data rarely       │',
    '│   changes (maybe on profile update).       │',
    '│   Add caching to getUserById."             │',
    '│                                             │',
    '│ Claude implements:                         │',
    '│ • Redis cache (uses existing connection)   │',
    '│ • 1-hour TTL (user data is stable)         │',
    '│ • Invalidation on profile update           │',
    '│ • Batch fetching for N+1 prevention        │',
    '│                                             │',
    '│ Solution fits YOUR infrastructure          │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'Context types that help:',
    '• WHY: Performance issue, user complaint',
    '• CONSTRAINTS: Use existing Redis, no new deps',
    '• SCALE: 50 calls/page, 10K daily users',
    '• PATTERN: What else works this way',
  ],

  'iterate': [
    '> Iteration builds understanding:',
    '',
    '┌─ Attempt 1 ──────────────────────────────────┐',
    '│ Claude adds pagination but breaks API      │',
    '│                                             │',
    '│ You: "The API signature changed - existing │',
    '│   callers would break. Keep original params,│',
    '│   add pagination as optional with defaults."│',
    '│                                             │',
    '│ Context gained: API must stay compatible   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Attempt 2 ──────────────────────────────────┐',
    '│ Claude adds optional params but no defaults│',
    '│                                             │',
    '│ You: "Good, but default to page=1, limit=20│',
    '│   so existing callers get first page."     │',
    '│                                             │',
    '│ Context gained: Specific default values    │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Attempt 3 ──────────────────────────────────┐',
    '│ Works but returns total wrong              │',
    '│                                             │',
    '│ You: "totalCount should be total items, not│',
    '│   items in current page."                  │',
    '│                                             │',
    '│ Context gained: totalCount semantics       │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Attempt 4 ──────────────────────────────────┐',
    '│ ✓ Perfect implementation                   │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'Each iteration ADDED context. Claude learned',
    'your API constraints through feedback.',
    'DON\'T /clear - iterate!',
  ],

  // ==========================================================================
  // CHAPTER 5: THE WAND RACK (Skills)
  // ==========================================================================

  'what-are-skills': [
    '$ claude "help me write a commit message"',
    '',
    '> Skill detected: commit-messages',
    '> Loading skill: ~/.claude/skills/commit/SKILL.md',
    '',
    '> Skill content now in context:',
    '  - Conventional commit format',
    '  - Team-specific scopes',
    '  - Examples of good/bad messages',
    '',
    '> Analyzing staged changes...',
    '',
    '> Using Bash tool...',
    '  git diff --cached --stat',
    '',
    '  src/auth/session.ts   | 34 ++++++++----',
    '  src/hooks/useAuth.ts  | 12 ++++',
    '  2 files changed, 35 insertions(+), 11 deletions(-)',
    '',
    '> Using Bash tool...',
    '  git diff --cached',
    '',
    '> Applying team commit conventions...',
    '',
    '  Suggested message:',
    '',
    '  feat(auth): add proactive session refresh',
    '',
    '  - Refresh JWT 5 minutes before expiry',
    '  - Add useAuth hook for refresh status',
    '  - Prevents logout during active sessions',
    '',
    '  Closes: AUTH-234',
    '',
    '> Format matches your team\'s conventions ✓',
  ],

  'skill-structure': [
    '$ cat ~/.claude/skills/api-review/SKILL.md',
    '',
    '---',
    'name: api-review',
    'description: Review API endpoints for REST best',
    '  practices, security, and our conventions.',
    '  Trigger on "review API" or "API feedback".',
    '---',
    '',
    '# API Review Checklist',
    '',
    '## URL Structure',
    '- Use plural nouns: /users not /user',
    '- Nest max 2 levels: /users/:id/posts',
    '- Use query params for filtering',
    '',
    '## HTTP Methods',
    '- GET: Read (idempotent)',
    '- POST: Create',
    '- PUT: Full update',
    '- PATCH: Partial update',
    '- DELETE: Remove',
    '',
    '## Response Format',
    '```json',
    '{',
    '  "data": {...},',
    '  "meta": { "page": 1, "total": 100 }',
    '}',
    '```',
    '',
    '## Security',
    '- Rate limit all endpoints',
    '- Validate all inputs with Zod',
    '- Never expose internal IDs',
    '',
    '───────────────────────────────────────────────',
    'This skill loads when you mention API review.',
    'Claude then follows YOUR conventions.',
  ],

  'skill-examples': [
    '> Real skill applications:',
    '',
    '┌─ Database Queries ───────────────────────────┐',
    '│ ~/.claude/skills/db-patterns/SKILL.md       │',
    '│                                             │',
    '│ $ claude "query users with recent orders"  │',
    '│                                             │',
    '│ > Skill: db-patterns loaded                │',
    '│ > Claude uses YOUR join patterns:          │',
    '│   - Uses your ORM (Prisma) syntax          │',
    '│   - Applies your indexing hints            │',
    '│   - Follows your naming conventions        │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ PR Description ────────────────────────────┐',
    '│ ~/.claude/skills/pr-template/SKILL.md       │',
    '│                                             │',
    '│ $ claude "create PR for this branch"       │',
    '│                                             │',
    '│ > Skill: pr-template loaded                │',
    '│ > Claude creates PR with:                  │',
    '│   - Your team\'s section headers            │',
    '│   - Links to relevant Jira tickets         │',
    '│   - Test plan checklist format             │',
    '│   - Screenshot placeholder                 │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Error Messages ────────────────────────────┐',
    '│ ~/.claude/skills/error-copy/SKILL.md        │',
    '│                                             │',
    '│ $ claude "add error for invalid card"      │',
    '│                                             │',
    '│ > Skill: error-copy loaded                 │',
    '│ > Claude uses YOUR voice:                  │',
    '│   - Matches brand tone (friendly)          │',
    '│   - Includes action suggestion             │',
    '│   - Uses approved terminology              │',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 6: THE SUMMONING SANCTUM (Subagents)
  // ==========================================================================

  'what-are-subagents': [
    '> Problem: Need to analyze 25 files',
    '',
    '┌─ Main Context ──────────────────────────────┐',
    '│ Current usage: 87,000 tokens (43.5%)       │',
    '│                                             │',
    '│ If we read 25 files directly:              │',
    '│   +45,000 tokens → 132,000 (66%)           │',
    '│   ⚠ Quality degradation zone              │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Using Task tool (subagent)...',
    '  Type: Explore',
    '  Task: "Map auth flow across all files"',
    '',
    '┌─ Subagent Context (FRESH) ──────────────────┐',
    '│ Starts at: ~6,800 tokens (system only)     │',
    '│                                             │',
    '│ > Read src/auth/login.ts         +1,200    │',
    '│ > Read src/auth/session.ts         +800    │',
    '│ > Read src/auth/jwt.ts           +1,500    │',
    '│ > Read src/auth/refresh.ts         +600    │',
    '│ > Read src/middleware/auth.ts      +500    │',
    '│ > Read src/hooks/useAuth.ts        +400    │',
    '│ > ... 19 more files ...          +12,000   │',
    '│                                             │',
    '│ Subagent total: ~24,000 tokens (12%)       │',
    '│ Full 200K available for analysis!          │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Subagent returns summary (~200 tokens):',
    '',
    '  "Auth uses JWT + refresh tokens. Flow:',
    '   login.ts issues tokens → stored in httpOnly',
    '   cookies → middleware validates on each',
    '   request → refresh.ts handles rotation..."',
    '',
    '┌─ Main Context After ────────────────────────┐',
    '│ 87,000 + 200 = 87,200 tokens (43.6%)       │',
    '│ Got knowledge from 25 files!               │',
    '└──────────────────────────────────────────────┘',
  ],

  'builtin-spirits': [
    '> Built-in subagent types:',
    '',
    '┌─ EXPLORE (Fast Scout) ──────────────────────┐',
    '│ Model: Haiku (fast, cheap)                 │',
    '│ Tools: Read, Grep, Glob (read-only)        │',
    '│                                             │',
    '│ $ claude "where is caching implemented?"   │',
    '│                                             │',
    '│ > Task(Explore): "Find caching code"       │',
    '│ > Searches entire codebase quickly         │',
    '│ > Returns: "Redis cache in src/cache/,     │',
    '│   in-memory LRU in src/utils/memoize.ts"   │',
    '│                                             │',
    '│ Cost: ~$0.002 for typical search           │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ PLAN (Deep Thinker) ───────────────────────┐',
    '│ Model: Opus (deep reasoning)               │',
    '│ Tools: Read, Grep, Glob (read-only)        │',
    '│                                             │',
    '│ $ claude "design payment retry strategy"   │',
    '│                                             │',
    '│ > Task(Plan): "Analyze and design..."      │',
    '│ > Deep analysis of existing patterns       │',
    '│ > Returns: Architectural recommendation    │',
    '│   with tradeoffs considered                │',
    '│                                             │',
    '│ Cost: ~$0.15 for complex analysis          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ GENERAL (Full Power) ──────────────────────┐',
    '│ Model: Sonnet (balanced)                   │',
    '│ Tools: ALL (can make changes)              │',
    '│                                             │',
    '│ $ claude "refactor auth into separate pkg" │',
    '│                                             │',
    '│ > Task(General): "Extract and refactor..." │',
    '│ > Can Read, Edit, Write, run tests         │',
    '│ > Returns: "Extracted to @company/auth,    │',
    '│   all tests passing"                       │',
    '└──────────────────────────────────────────────┘',
  ],

  'delegation-pattern': [
    '$ claude "implement user export feature"',
    '',
    '> Main agent reasons:',
    '  "Complex feature. Need to understand:',
    '   1. User data structure',
    '   2. Export format requirements',
    '   3. Existing download patterns',
    '   Then implement."',
    '',
    '> Using Task tool (Explore)...',
    '  "Map user data model and export patterns"',
    '',
    '┌─ Explore Subagent ──────────────────────────┐',
    '│ > Read src/models/User.ts                  │',
    '│ > Grep "export|download" in src/           │',
    '│ > Read src/utils/csv.ts                    │',
    '│ > Read src/routes/downloads.ts             │',
    '│                                             │',
    '│ Returns: "User has 12 fields, 3 relations. │',
    '│   Existing CSV util at csv.ts. Downloads   │',
    '│   use streaming pattern in downloads.ts"   │',
    '└──────────────────────────────────────────────┘',
    '',
    '> Main agent continues with knowledge:',
    '',
    '> Using Write tool...',
    '  src/routes/users/export.ts (new endpoint)',
    '',
    '> Using Edit tool...',
    '  src/utils/csv.ts (add user formatter)',
    '',
    '> Using Bash tool...',
    '  npm test -- --testPathPattern=export',
    '',
    '✓ Export feature complete. Uses existing',
    '  CSV util and streaming download pattern.',
  ],

  'context-isolation': [
    '> Why isolation matters:',
    '',
    '┌─ WITHOUT subagent ──────────────────────────┐',
    '│                                             │',
    '│ Main context: 85K tokens (42.5%)           │',
    '│                                             │',
    '│ $ claude "analyze all payment code for     │',
    '│   security issues, then fix them"          │',
    '│                                             │',
    '│ > Read payment/*.ts (8 files)    +15,000   │',
    '│ > Read stripe/*.ts (5 files)      +8,000   │',
    '│ > Read webhooks/*.ts (4 files)    +6,000   │',
    '│ > Analysis reasoning              +2,000   │',
    '│ > Edit fixes                      +1,500   │',
    '│                                             │',
    '│ Final: 117,500 tokens (58.75%)             │',
    '│                                             │',
    '│ Problems:                                  │',
    '│ • All file contents stuck in context       │',
    '│ • Can\'t be removed, even after fixes      │',
    '│ • Quality degrades for next task           │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ WITH subagent ─────────────────────────────┐',
    '│                                             │',
    '│ Main context: 85K tokens (42.5%)           │',
    '│                                             │',
    '│ > Task(Explore): Security analysis         │',
    '│   [Subagent reads 17 files privately]      │',
    '│   Returns: 200 token summary               │',
    '│                                             │',
    '│ > Main applies targeted fixes:             │',
    '│   Read only 2 files that need changes      │',
    '│                                             │',
    '│ Final: 88,400 tokens (44.2%)               │',
    '│                                             │',
    '│ Benefits:                                  │',
    '│ • Analysis knowledge preserved             │',
    '│ • File contents not in main context        │',
    '│ • Plenty of room for next task             │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
  ],

  // ==========================================================================
  // CHAPTER 7: THE PORTAL NEXUS (MCP)
  // ==========================================================================

  'what-is-mcp': [
    '> Without MCP (context switching):',
    '',
    '  1. Open Jira → Read ticket PROJ-123',
    '  2. Switch to VS Code → Make changes',
    '  3. Switch to Terminal → Run tests',
    '  4. Switch to GitHub → Create PR',
    '  5. Switch to Jira → Update status',
    '  6. Switch to Slack → Notify team',
    '',
    '  Context switches: 6',
    '  Flow interruptions: 6',
    '  Time lost: ~15 minutes',
    '',
    '───────────────────────────────────────────────',
    '',
    '> With MCP (zero context switching):',
    '',
    '$ claude "implement PROJ-123 and notify team"',
    '',
    '> MCP: jira.getIssue("PROJ-123")',
    '  "Add retry logic to payment webhook"',
    '',
    '> Using Edit tool...',
    '  src/webhooks/payment.ts',
    '',
    '> Using Bash tool...',
    '  npm test webhooks/payment.test.ts',
    '  ✓ All tests passing',
    '',
    '> MCP: github.createPullRequest({...})',
    '  PR #456 created',
    '',
    '> MCP: jira.updateStatus("In Review")',
    '> MCP: slack.postMessage("#eng", "...")',
    '',
    '  Context switches: 0',
    '  Flow state: Maintained',
    '  Total time: 8 minutes',
  ],

  'connecting-services': [
    '> Setting up MCP connections:',
    '',
    '$ claude mcp add github',
    '',
    '┌─ GitHub MCP Server ─────────────────────────┐',
    '│ Connecting to official GitHub MCP...       │',
    '│                                             │',
    '│ Authentication required.                   │',
    '│ > Opening browser for OAuth...             │',
    '│ > ✓ Authenticated as @yourname             │',
    '│                                             │',
    '│ Tools now available:                       │',
    '│   • github.getIssue                        │',
    '│   • github.createIssue                     │',
    '│   • github.createPullRequest               │',
    '│   • github.listPRs                         │',
    '│   • github.mergePR                         │',
    '│   • ... 7 more tools                       │',
    '│                                             │',
    '│ ✓ 12 tools connected                       │',
    '└──────────────────────────────────────────────┘',
    '',
    '$ /mcp',
    '',
    '  Connected MCP servers:',
    '',
    '  ● github        12 tools  (official)',
    '  ● slack          6 tools  (official)',
    '  ● postgres       5 tools  (community)',
    '  ● jira           8 tools  (official)',
    '',
    '───────────────────────────────────────────────',
    'MCP connections persist across conversations.',
    'Tools appear alongside Claude\'s built-in tools.',
  ],

  'portal-examples': [
    '> MCP in action:',
    '',
    '┌─ GitHub: Issue → Implementation → PR ───────┐',
    '│                                             │',
    '│ $ claude "implement issue #142"            │',
    '│                                             │',
    '│ > MCP: github.getIssue(142)                │',
    '│   "Add dark mode toggle to settings page"  │',
    '│                                             │',
    '│ > Read src/pages/Settings.tsx              │',
    '│ > Edit: Add ThemeToggle component          │',
    '│ > Bash: npm test Settings.test.tsx         │',
    '│                                             │',
    '│ > MCP: github.createPullRequest({          │',
    '│     title: "feat: add dark mode toggle",   │',
    '│     body: "Closes #142",                   │',
    '│     branch: "feature/dark-mode"            │',
    '│   })                                       │',
    '│                                             │',
    '│ ✓ PR #158 created and linked to issue      │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Slack: Automated Updates ──────────────────┐',
    '│                                             │',
    '│ $ claude "post deploy summary to #releases"│',
    '│                                             │',
    '│ > Bash: git log --oneline v2.3.0..HEAD    │',
    '│ > MCP: slack.postMessage({                 │',
    '│     channel: "#releases",                  │',
    '│     text: "🚀 v2.4.0 deployed\\n..."       │',
    '│   })                                       │',
    '│                                             │',
    '│ ✓ Posted to #releases                      │',
    '└──────────────────────────────────────────────┘',
  ],

  'chain-workflows': [
    '$ claude "complete sprint planning for next week"',
    '',
    '> MCP: jira.getSprintBacklog("PROJ")',
    '  Found 12 unassigned tickets',
    '',
    '> MCP: github.listOpenPRs()',
    '  Found 3 PRs needing review',
    '',
    '> Analyzing capacity and priorities...',
    '',
    '> MCP: jira.updateIssue("PROJ-456", {',
    '    assignee: "alice",',
    '    sprint: "Sprint 23"',
    '  })',
    '',
    '> MCP: jira.updateIssue("PROJ-457", {...})',
    '> MCP: jira.updateIssue("PROJ-458", {...})',
    '> ... 9 more assignments ...',
    '',
    '> MCP: slack.postMessage("#team", {',
    '    text: "Sprint 23 planned! Assignments:\\n"',
    '      + "• Alice: PROJ-456, PROJ-460\\n"',
    '      + "• Bob: PROJ-457, PROJ-461\\n"',
    '      + "..."',
    '  })',
    '',
    '> MCP: google.createEvent({',
    '    title: "Sprint 23 Kickoff",',
    '    attendees: ["team@company.com"],',
    '    time: "Monday 10am"',
    '  })',
    '',
    '───────────────────────────────────────────────',
    '4 services orchestrated in one conversation.',
    'Jira + GitHub + Slack + Google Calendar',
  ],

  'mcp-safety': [
    '> MCP security considerations:',
    '',
    '┌─ Official Connectors (Recommended) ─────────┐',
    '│ Verified by Anthropic:                     │',
    '│                                             │',
    '│ ● GitHub      - Code hosting, issues, PRs  │',
    '│ ● Slack       - Team messaging             │',
    '│ ● Google      - Calendar, Drive, Docs      │',
    '│ ● Linear      - Issue tracking             │',
    '│ ● PostgreSQL  - Database queries           │',
    '│                                             │',
    '│ ✓ Audited for security                     │',
    '│ ✓ Minimal permissions requested            │',
    '│ ✓ Data handling reviewed                   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Third-Party Connectors (Caution) ──────────┐',
    '│ Community or vendor-provided:              │',
    '│                                             │',
    '│ ⚠ NOT verified by Anthropic               │',
    '│                                             │',
    '│ Before connecting:                         │',
    '│ 1. Review source code on GitHub            │',
    '│ 2. Check requested permissions             │',
    '│ 3. Verify publisher reputation             │',
    '│ 4. Use minimal scope possible              │',
    '│                                             │',
    '│ $ claude mcp permissions myconnector       │',
    '│   Requested: read:repos, write:issues      │',
    '│   ⚠ Also requests: admin:org (why?)       │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'Rule: Would you give this service your token?',
    'If unsure → Don\'t connect it',
  ],

  // ==========================================================================
  // CHAPTER 8: BREAKING THE LOOP (Troubleshooting)
  // ==========================================================================

  'breaking-loops': [
    '> Recognizing a stuck loop:',
    '',
    '$ claude "fix the TypeScript error"',
    '> Edit: Add type annotation',
    '',
    '$ npm run build',
    '  Error: Type mismatch on line 45',
    '',
    '$ claude "still getting type error"',
    '> Edit: Change type to any',
    '',
    '$ npm run build',
    '  Error: \'any\' not allowed by eslint',
    '',
    '$ claude "now eslint is complaining"',
    '> Edit: Disable eslint rule',
    '',
    '$ npm run build',
    '  Error: Other type error surfaced',
    '',
    '───────────────────────────────────────────────',
    '> STOP. This is a loop.',
    '',
    '> Signs of a loop:',
    '  • Same file edited 3+ times',
    '  • Each fix creates new error',
    '  • Claude apologizing repeatedly',
    '  • "Let me try a different approach..."',
    '',
    '> Solution:',
    '',
    '$ /clear',
    '',
    '$ claude "I need to fix type errors in',
    '  src/utils/transform.ts. Here\'s the data',
    '  shape: { items: Array<{id: string, ',
    '  value: number}> }. The function should',
    '  return the sum of all values."',
    '',
    '> Fresh context + concrete spec = success',
  ],

  'reframing': [
    '> Three reframing strategies:',
    '',
    '┌─ 1. Change Abstraction Level ───────────────┐',
    '│                                             │',
    '│ Too vague:                                  │',
    '│   "Fix the authentication"                 │',
    '│                                             │',
    '│ More specific:                             │',
    '│   "In src/auth/jwt.ts line 45,             │',
    '│    validateToken returns null instead of   │',
    '│    throwing on expired tokens"             │',
    '│                                             │',
    '│ Or zoom out:                               │',
    '│   "Users are getting logged out randomly.  │',
    '│    Help me debug why."                     │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 2. Change Starting Point ──────────────────┐',
    '│                                             │',
    '│ Instead of iterating on broken code:       │',
    '│   "Fix this function to handle edge cases" │',
    '│                                             │',
    '│ Specify desired behavior:                  │',
    '│   "Write a function that: takes an array,  │',
    '│    filters nulls, transforms to {id, name},│',
    '│    sorts by name. Here\'s example I/O..."   │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ 3. Relax Then Constrain ───────────────────┐',
    '│                                             │',
    '│ Stuck on:                                  │',
    '│   "Add feature X without changing the API" │',
    '│                                             │',
    '│ Try:                                       │',
    '│   "How would you add X if you COULD change │',
    '│    the API? Show me the ideal solution."   │',
    '│                                             │',
    '│ Then:                                      │',
    '│   "Now adapt that to keep the current API" │',
    '└──────────────────────────────────────────────┘',
  ],

  'escape-hatches': [
    '> Emergency controls:',
    '',
    '┌─ Interrupt ─────────────────────────────────┐',
    '│                                             │',
    '│ [Escape]         Stop current operation    │',
    '│                  (Claude stops mid-task)   │',
    '│                                             │',
    '│ [Escape][Escape] Exit Claude Code entirely │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Undo Changes ──────────────────────────────┐',
    '│                                             │',
    '│ $ /undo                                    │',
    '│                                             │',
    '│   Reverted:                                │',
    '│   • src/auth/login.ts                      │',
    '│   • src/hooks/useAuth.ts                   │',
    '│                                             │',
    '│   2 files restored to previous state       │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Git Safety Net ────────────────────────────┐',
    '│                                             │',
    '│ Before risky experiments:                  │',
    '│ $ git stash                                │',
    '│                                             │',
    '│ If things go wrong:                        │',
    '│ $ git stash pop      # Restore changes     │',
    '│ $ git checkout .     # Discard all changes │',
    '│ $ git clean -fd      # Remove new files    │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Fresh Start ───────────────────────────────┐',
    '│                                             │',
    '│ $ /clear                                   │',
    '│                                             │',
    '│   Conversation cleared.                    │',
    '│   CLAUDE.md retained.                      │',
    '│   Ready for fresh approach.                │',
    '│                                             │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'You always have control.',
    'Escape → /undo → git → /clear',
  ],

  'conclusion': [
    '> Your Claude Code mastery checklist:',
    '',
    '┌─ Fundamentals ───────────────────────────────┐',
    '│ ✓ Understand the agentic loop              │',
    '│ ✓ Manage context proactively               │',
    '│ ✓ Use CLAUDE.md for persistent knowledge   │',
    '│ ✓ Know when to /clear vs /compact          │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Tools ─────────────────────────────────────┐',
    '│ ✓ Read + Grep before Edit                  │',
    '│ ✓ Bash for commands, not file operations   │',
    '│ ✓ Task for context-heavy exploration       │',
    '│ ✓ Let Claude choose tools from your prompt │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Prompting ─────────────────────────────────┐',
    '│ ✓ Be specific: file, function, behavior    │',
    '│ ✓ Use constraints to limit scope           │',
    '│ ✓ Give context: WHY, not just WHAT         │',
    '│ ✓ Iterate instead of starting over         │',
    '└──────────────────────────────────────────────┘',
    '',
    '┌─ Power Features ────────────────────────────┐',
    '│ ✓ Skills for repeatable patterns           │',
    '│ ✓ Subagents for context isolation          │',
    '│ ✓ MCP for external service integration     │',
    '│ ✓ Plan mode (Shift+Tab+Tab) for complexity │',
    '└──────────────────────────────────────────────┘',
    '',
    '───────────────────────────────────────────────',
    'The magic is in the collaboration.',
    'You provide direction. Claude provides depth.',
  ],
}

/**
 * Get beat-specific example content, or return undefined if none exists.
 */
export function getBeatExampleContent(beatId: string): string[] | undefined {
  return BEAT_EXAMPLE_CONTENT[beatId]
}
